---
## Front matter
title: "Отчёт по лабораторной работе 2"
subtitle: "Настройка DNS-сервера"
author: "Гафоров Нурмухаммад"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Введение

## Цель работы  

Приобретение практических навыков по установке и конфигурированию DNSсервера, усвоение принципов работы системы доменных имён.

# Ход выполнения

После загрузки виртуальной машины server был выполнен вход под ранее созданным пользователем и произведён переход в режим суперпользователя.

## Установка DNS-сервера

Через диспетчер пакетов была выполнена установка пакетов bind и bind-utils.  
Для проверки работы DNS было осуществлено обращение к внешнему DNS-серверу с использованием утилиты dig. Команда отобразила:

- запрос типа A — резолвинг доменного имени в IPv4-адрес;
- секцию ANSWER SECTION с несколькими IP-адресами, принадлежащими домену;
- блок SERVER, содержащий IP-адрес DNS-сервера, обслужившего запрос.

![Результат первичного DNS-запроса (внешний DNS)](Screenshot_7.png){ #fig:007 width=85% }

## Анализ конфигурационных файлов

Содержимое /etc/resolv.conf показало текущие DNS-сервера, используемые системой.

В конфигурационном файле /etc/named.conf обнаружены параметры, определяющие режим работы DNS-сервера: директории хранения, файлы статистики, политики доступа.

![Файл named.conf](Screenshot_8.png){ #fig:009 width=80% }

Файл /var/named/named.ca содержит перечень корневых серверов DNS, необходимых для построения цепочки DNS-разрешения.

![Файл named.ca](Screenshot_9.png){ #fig:010 width=80% }

В файлах /var/named/named.localhost и /var/named/named.loopback описаны локальные зоны для обратного и прямого резолвинга адресов loopback-интерфейса.

![Файлы named.localhost и named.loopback](Screenshot_10.png){ #fig:011 width=75% }

## Запуск и проверка работы DNS-сервера

DNS-сервер был запущен и добавлен в автозагрузку.  
После этого была выполнена проверка с использованием dig, но теперь запрос направлялся непосредственно на локальный DNS-сервер по адресу 127.0.0.1. В результате:

- запрос был обработан без обращения напрямую к внешнему DNS,
- IP-адреса домена были успешно получены.

![Запрос через локальный DNS-сервер](Screenshot_11.png){ #fig:012 width=85% }

## Назначение локального DNS-сервера по умолчанию

Были изменены параметры сетевого интерфейса eth0 через NetworkManager. Сервер получил настройку использования 127.0.0.1 как DNS-сервера по умолчанию. После перезапуска NetworkManager это отразилось в файле /etc/resolv.conf.

![Изменение DNS через nmcli](Screenshot_12.png){ #fig:013 width=85% }

## Открытие доступа к DNS в локальной сети

Для разрешения обработки запросов не только от localhost была внесена корректировка в /etc/named.conf:

- адрес, на котором принимает запросы DNS-сервер, расширен до any;
- разрешён доступ клиентам локальной сети 192.168.0.0/16.

![Изменение подсети в named.conf](Screenshot_13.png){ #fig:014 width=80% }

## Настройка межсетевого экрана

Через firewall был разрешён DNS-трафик, после чего проверено, что сервер прослушивает порт 53 по UDP.

![DNS-порт прослушивается](Screenshot_14.png){ #fig:015 width=85% }

## Создание файла зон

В каталоге `/etc/named` был создан файл конфигурации DNS-зон, основанный на шаблоне `named.rfc1912.zones`. В конце основного конфигурационного файла `/etc/named.conf` была добавлена строка, подключающая новый файл описания зон.

![Подключение файла зоны в named.conf](Screenshot_15.png){ #fig:01155 width=75% }

Файл `/etc/named/ngaforov.net` был отредактирован: удалены стандартные зоны `localhost`, добавлены зоны прямого и обратного разрешения.

![Файл зоны ngaforov.net](Screenshot_16.png){ #fig:016 width=80% }

## Прямая зона

В каталоге `/var/named/master/fz` был создан файл зоны с именем `ngaforov.net`, содержащий описание SOA-записи и A-записей сервера и NS-записей.

![Файл прямой зоны](Screenshot_17.png){ #fig:017 width=80% }

## Обратная зона

В каталоге `/var/named/master/rz` был создан файл обратной зоны с указанием соответствия адресов PTR-записям.

![Файл обратной зоны](Screenshot_18.png){ #fig:018 width=80% }

## Настройка SELinux и прав доступа

Для корректной работы службы DNS права доступа к каталогам были переданы пользователю и группе `named`. После изменения контексты SELinux были восстановлены:

![Настройка SELinux и прав доступа](Screenshot_19.png){ #fig:019 width=85% }

## Проверка работы DNS-сервера

После перезапуска DNS-службы был выполнен тестовый запрос через `dig`, подтверждающий, что DNS-сервер корректно возвращает A-запись для `ns.ngaforov.net`.

![Результат запроса dig](Screenshot_20.png){ #fig:020 width=85% }

Затем с помощью утилиты `host` были проверены:

- вывод полной зоны,
- запись A,
- запись PTR.

![Результаты проверки зоны через host](Screenshot_21.png){ #fig:021 width=90% }

## Подготовка файлов для автоматизации

В каталоге `/vagrant/provision/server/dns` были размещены конфигурационные файлы DNS, предназначенные для автоматизированного развёртывания сервера через Vagrant provisioning-скрипт.  

Создан файл `dns.sh`, в который включены команды установки пакетов, настройки BIND, SELinux и сетевых параметров.

![Provisioning-скрипт dns.sh](Screenshot_22.png){ #fig:022 width=75% }

# Вывод

В ходе работы был развёрнут и настроен первичный DNS-сервер BIND. Созданы прямые и обратные зоны, выполнена корректировка SELinux и проверена работоспособность с помощью `dig` и `host`. DNS-сервер корректно обрабатывает запросы и функционирует в роли master-сервера.

## Контрольные вопросы

### 1. Что такое DNS?
DNS (Domain Name System) — распределённая система, преобразующая доменные имена в IP-адреса и обратно.

### 2. Каково назначение кэширующего DNS-сервера?
Кэширующий DNS-сервер запрашивает данные у внешних DNS и временно сохраняет их, уменьшая количество запросов в интернет и ускоряя последующие ответы.

### 3. Чем отличается прямая DNS-зона от обратной?
Прямая зона преобразует доменное имя → в IP-адрес (A-записи).  
Обратная зона преобразует IP-адрес → в доменное имя (PTR-записи).

### 4. В каких каталогах и файлах располагаются настройки DNS-сервера?
- `/etc/named.conf` — основной конфигурационный файл BIND.
- `/etc/named/` — дополнительные файлы настроек зон.
- `/var/named/` — файлы DNS-зон (прямые и обратные зоны).

### 5. Что указывается в файле resolv.conf?
Содержит список DNS-серверов, используемых системой для резолвинга.

### 6. Какие типы записи описания ресурсов есть в DNS?
- **A** — доменное имя → IPv4-адрес.
- **AAAA** — доменное имя → IPv6-адрес.
- **NS** — указание DNS-серверов зоны.
- **SOA** — сведения о зоне (серийный номер, времена обновления).
- **PTR** — обратное преобразование адреса в имя.
- **MX** — почтовый сервер домена.
- **CNAME** — алиас (псевдоним доменного имени).

### 7. Для чего используется домен in-addr.arpa?
Для обратного DNS-разрешения (поиск имени по IP-адресу).

### 8. Для чего нужен демон named?
`named` — служба BIND, обрабатывающая DNS-запросы.

### 9. В чём заключаются функции master-сервера и slave-сервера?
- **Master** хранит оригинальные файлы зон и разрешает изменения.
- **Slave** получает копию зоны с master-сервера и обеспечивает отказоустойчивость.

### 10. Какие параметры отвечают за время обновления зоны?
В секции **SOA**:
- refresh — интервал обновления,
- retry — повторная попытка,
- expire — срок актуальности зоны на slave.

### 11. Как обеспечить защиту зоны от скачивания и просмотра?
Ограничить доступ настройками `allow-transfer { ... }` и `allow-query { ... }` в зоне.

### 12. Какая запись RR применяется при создании почтовых серверов?
MX (Mail eXchanger).

### 13. Как протестировать работу сервера доменных имён?
Через утилиты:
- `dig`
- `host`
- `nslookup`

### 14. Как запустить, перезапустить или остановить службу?
Через systemd:
- `systemctl start`
- `systemctl restart`
- `systemctl stop`

### 15. Как посмотреть отладочную информацию при запуске сервиса?
Просмотреть лог: journalctl -xe

### 16. Где хранится отладочная информация?
В системных логах journald: journalctl -u <service>

### 17. Как посмотреть, какие файлы использует процесс?
Команда: lsof -p <PID>

### 18. Примеры изменения сетевого соединения через nmcli:
- просмотр соединений: `nmcli connection show`
- изменение DNS: `nmcli connection edit eth0`

### 19. Что такое SELinux?
SELinux — подсистема безопасности, контролирующая доступ процессов к ресурсам.

### 20. Что такое контекст (метка) SELinux?
Это атрибут файла или процесса, определяющий уровень доступа.

### 21. Как восстановить контекст SELinux?
restorecon -vR /путь

### 22. Как создать разрешающие правила из журналов?
С помощью: audit2allow

### 23. Что такое булевый переключатель SELinux?
Настройка SELinux, регулирующая поведение политики безопасности.

### 24. Как посмотреть список переключателей SELinux?
getsebool -a

### 25. Как изменить состояние переключателя?
setsebool <switch> on/off
